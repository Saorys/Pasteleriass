<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Iniciar Sesión - Mil Sabores</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
  <!--======================= HEADER =======================-->
  <header class="topbar">
    <div class="logo">
      <img src="../assets/img/logo.png" alt="Logo Mil Sabores">
    </div>

    <div>
      <strong>Tienda online - Mil Sabores</strong>
    </div>

    <nav class="navegacion" aria-label="Navegación principal">
      <a href="../index.html">Home</a>
      <a href="../index.html#productos">Productos</a>
      <a href="nosotros.html">Nosotros</a>
      <a href="../html/blog.html">Blog</a>
      <a href="../html/contacto.html">Contacto</a>
    </nav>

    <div class="usuario">
      <a href="iniciarSesion.html">Iniciar sesión</a>
      <span class="separar">|</span>
      <a href="registro.html">Registrarse</a>
      <span class="separar">|</span>
      <span>Carrito (0)</span>
    </div>
  </header>

  <!-- ======================= MAIN ======================= -->
  <main class="main">
    <div class="form-container">
      <h1>Iniciar Sesión</h1>
      <p style="text-align: center; color: var(--text-color); margin-bottom: 30px;">
        Accede a tu cuenta para disfrutar de nuestros deliciosos postres
      </p>

      <form id="form-login" method="post" novalidate>
        <!-- Correo Electrónico -->
        <div class="form-group">
          <label for="correo">Correo Electrónico:</label>
          <input type="email" id="correo" name="correo" required />
          <div class="error-message" id="error-correo"></div>
        </div>

        <!-- Contraseña -->
        <div class="form-group">
          <label for="password">Contraseña:</label>
          <input type="password" id="password" name="password" required />
          <div class="error-message" id="error-password"></div>
        </div>

        <!-- Recordar sesión -->
        <div class="form-group" style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px;">
          <input type="checkbox" id="recordar" name="recordar" />
          <label for="recordar" style="margin-bottom: 0; font-weight: 500;">Recordar mi sesión</label>
        </div>

        <!-- Botones -->
        <button type="submit" class="btn-primaria">Iniciar Sesión</button>
        <button type="button" class="btn-secundaria" onclick="window.location.href='registro.html'">
          ¿No tienes cuenta? Regístrate aquí
        </button>
      </form>

      <!-- Enlaces adicionales -->
      <div style="text-align: center; margin-top: 20px;">
        <a href="#" style="color: var(--primary-color); text-decoration: none; font-size: 0.9rem;">
          ¿Olvidaste tu contraseña?
        </a>
      </div>

      <!-- Mensajes de estado -->
      <div class="success-message" id="success-message" style="display: none;">
        ¡Inicio de sesión exitoso! Redirigiendo...
      </div>
      
      <div class="error-message" id="login-error" style="display: none; text-align: center; margin-top: 20px;">
        Credenciales incorrectas. Verifica tu correo y contraseña.
      </div>
    </div>
  </main>

  <!-- ======================= FOOTER ======================= -->
  <footer class="footer" id="contacto">
    <nav aria-label="Redes">
      <a href="#">X</a> ·
      <a href="#" id="blog">Instagram</a> ·
      <a href="#">WhatsApp</a>
    </nav>

    <form class="newsletter" action="#" method="post">
      <label for="email">Suscríbete a nuestro newsletter</label>
      <input id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" />
      <button type="submit">Suscribirse</button>
    </form>
  </footer>

  <!-- JavaScript para validaciones y autenticación -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('form-login');
      const correoInput = document.getElementById('correo');
      const passwordInput = document.getElementById('password');
      
      // Simulación de base de datos de usuarios (en un proyecto real esto vendría del servidor)
      const usuariosRegistrados = JSON.parse(localStorage.getItem('usuariosRegistrados') || '[]');
      
      // Función para validar email
      function validarEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }
      
      // Función para mostrar error
      function mostrarError(campoId, mensaje) {
        const campo = document.getElementById(campoId);
        const errorDiv = document.getElementById('error-' + campoId);
        
        campo.classList.remove('valid');
        campo.classList.add('invalid');
        errorDiv.textContent = mensaje;
        errorDiv.classList.add('show');
      }
      
      // Función para mostrar éxito
      function mostrarExito(campoId) {
        const campo = document.getElementById(campoId);
        const errorDiv = document.getElementById('error-' + campoId);
        
        campo.classList.remove('invalid');
        campo.classList.add('valid');
        errorDiv.classList.remove('show');
      }
      
      // Función para limpiar error
      function limpiarError(campoId) {
        const campo = document.getElementById(campoId);
        const errorDiv = document.getElementById('error-' + campoId);
        
        campo.classList.remove('invalid', 'valid');
        errorDiv.classList.remove('show');
      }
      
      // Función para mostrar error de login
      function mostrarErrorLogin(mensaje) {
        const errorDiv = document.getElementById('login-error');
        errorDiv.textContent = mensaje;
        errorDiv.classList.add('show');
        errorDiv.style.display = 'block';
        
        // Ocultar mensaje de éxito si está visible
        document.getElementById('success-message').style.display = 'none';
      }
      
      // Función para mostrar éxito de login
      function mostrarExitoLogin() {
        const successDiv = document.getElementById('success-message');
        successDiv.style.display = 'block';
        
        // Ocultar error de login si está visible
        document.getElementById('login-error').style.display = 'none';
      }
      
      // Validación en tiempo real para correo
      correoInput.addEventListener('blur', function() {
        const valor = this.value.trim();
        
        if (valor && !validarEmail(valor)) {
          mostrarError('correo', 'Ingresa un correo electrónico válido');
        } else if (valor) {
          mostrarExito('correo');
        } else {
          limpiarError('correo');
        }
      });
      
      // Validación en tiempo real para contraseña
      passwordInput.addEventListener('blur', function() {
        const valor = this.value;
        
        if (valor && valor.length < 4) {
          mostrarError('password', 'La contraseña debe tener al menos 4 caracteres');
        } else if (valor) {
          mostrarExito('password');
        } else {
          limpiarError('password');
        }
      });
      
      // Función para verificar credenciales
      function verificarCredenciales(correo, password) {
        // Buscar usuario en la "base de datos" local
        const usuario = usuariosRegistrados.find(user => 
          user.correo === correo && user.password === password
        );
        
        return usuario;
      }
      
      // Función para guardar sesión
      function guardarSesion(usuario) {
        const sesionActiva = {
          correo: usuario.correo,
          nombre: usuario.nombre,
          fechaLogin: new Date().toISOString()
        };
        
        localStorage.setItem('sesionActiva', JSON.stringify(sesionActiva));
        
        // Si el usuario marcó "recordar sesión", guardar por más tiempo
        const recordar = document.getElementById('recordar').checked;
        if (recordar) {
          localStorage.setItem('recordarSesion', 'true');
        }
      }
      
      // Función para verificar si hay sesión activa
      function verificarSesionActiva() {
        const sesionActiva = localStorage.getItem('sesionActiva');
        const recordarSesion = localStorage.getItem('recordarSesion');
        
        if (sesionActiva && recordarSesion === 'true') {
          const sesion = JSON.parse(sesionActiva);
          const fechaLogin = new Date(sesion.fechaLogin);
          const ahora = new Date();
          const diferenciaDias = (ahora - fechaLogin) / (1000 * 60 * 60 * 24);
          
          // Si han pasado menos de 30 días, mantener sesión activa
          if (diferenciaDias < 30) {
            mostrarExitoLogin();
            setTimeout(() => {
              window.location.href = '../../index.html';
            }, 1500);
            return true;
          }
        }
        
        return false;
      }
      
      // Verificar sesión activa al cargar la página
      if (verificarSesionActiva()) {
        return; // Si hay sesión activa, no continuar con el resto del código
      }
      
      // Validación del formulario completo
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const correo = correoInput.value.trim();
        const password = passwordInput.value;
        
        let esValido = true;
        
        // Validar correo
        if (!correo) {
          mostrarError('correo', 'El correo electrónico es requerido');
          esValido = false;
        } else if (!validarEmail(correo)) {
          mostrarError('correo', 'Ingresa un correo electrónico válido');
          esValido = false;
        }
        
        // Validar contraseña
        if (!password) {
          mostrarError('password', 'La contraseña es requerida');
          esValido = false;
        } else if (password.length < 4) {
          mostrarError('password', 'La contraseña debe tener al menos 4 caracteres');
          esValido = false;
        }
        
        if (esValido) {
          // Verificar credenciales
          const usuario = verificarCredenciales(correo, password);
          
          if (usuario) {
            // Credenciales correctas
            guardarSesion(usuario);
            mostrarExitoLogin();
            
            // Redirigir después de 1.5 segundos
            setTimeout(() => {
              window.location.href = '../../index.html';
            }, 1500);
          } else {
            // Credenciales incorrectas
            mostrarErrorLogin('Credenciales incorrectas. Verifica tu correo y contraseña.');
            
            // Limpiar campos
            correoInput.classList.add('invalid');
            passwordInput.classList.add('invalid');
            
            // Scroll al formulario
            form.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        } else {
          // Scroll al primer error
          const primerError = form.querySelector('.invalid');
          if (primerError) {
            primerError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      });
      
      // Función para mostrar usuarios registrados (solo para desarrollo)
      function mostrarUsuariosRegistrados() {
        console.log('Usuarios registrados:', usuariosRegistrados);
        if (usuariosRegistrados.length === 0) {
          console.log('No hay usuarios registrados. Regístrate primero.');
        }
      }
      
      // Mostrar usuarios registrados en consola (para desarrollo)
      mostrarUsuariosRegistrados();
      
      // Función para limpiar campos
      function limpiarCampos() {
        correoInput.value = '';
        passwordInput.value = '';
        correoInput.classList.remove('valid', 'invalid');
        passwordInput.classList.remove('valid', 'invalid');
        document.getElementById('error-correo').classList.remove('show');
        document.getElementById('error-password').classList.remove('show');
        document.getElementById('login-error').style.display = 'none';
        document.getElementById('success-message').style.display = 'none';
      }
      
      // Limpiar campos al hacer clic en "Regístrate aquí"
      document.querySelector('.btn-secundaria').addEventListener('click', function() {
        limpiarCampos();
      });
    });
  </script>
</body>
</html>
