<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro - Mil Sabores</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
  <!--======================= HEADER =======================-->
  <header class="topbar">
    <div class="logo">
      <img src="../assets/img/logo.png" alt="Logo Mil Sabores">
    </div>

    <div>
      <strong>Tienda online - Mil Sabores</strong>
    </div>

    <nav class="navegacion" aria-label="Navegación principal">
      <a href="../index.html">Home</a>
      <a href="../index.html#productos">Productos</a>
      <a href="nosotros.html">Nosotros</a>
      <a href="../html/blog.html">Blog</a>
      <a href="../html/contacto.html">Contacto</a>
    </nav>

    <div class="usuario">
      <a href="iniciarSesion.html">Iniciar sesión</a>
      <span class="separar">|</span>
      <a href="registro.html">Registrarse</a>
      <span class="separar">|</span>
      <span>Carrito (0)</span>
    </div>
  </header>

  <!-- ======================= MAIN ======================= -->
  <main class="main">
    <div class="form-container">
      <h1>Crear Cuenta</h1>
      <p style="text-align: center; color: var(--text-color); margin-bottom: 30px;">
        Únete a nuestra comunidad y disfruta de los mejores postres
      </p>

      <form id="form-registro" method="post" novalidate>
        <!-- RUN -->
        <div class="form-group">
          <label for="run">RUN (sin puntos ni guión):</label>
          <input type="text" id="run" name="run" minlength="7" maxlength="9" required />
          <div class="error-message" id="error-run"></div>
        </div>

        <!-- Nombre Completo -->
        <div class="form-group">
          <label for="nombre">Nombre Completo:</label>
          <input type="text" id="nombre" name="nombre" required />
          <div class="error-message" id="error-nombre"></div>
        </div>

        <!-- Correo -->
        <div class="form-group">
          <label for="correo">Correo Electrónico:</label>
          <input type="email" id="correo" name="correo" required />
          <div class="error-message" id="error-correo"></div>
        </div>

        <!-- Confirmar Correo -->
        <div class="form-group">
          <label for="correo2">Confirmar Correo Electrónico:</label>
          <input type="email" id="correo2" name="correo2" required />
          <div class="error-message" id="error-correo2"></div>
        </div>

        <!-- Contraseña -->
        <div class="form-group">
          <label for="password">Contraseña:</label>
          <input type="password" id="password" name="password" minlength="4" maxlength="10" required />
          <div class="error-message" id="error-password"></div>
        </div>

        <!-- Confirmar Contraseña -->
        <div class="form-group">
          <label for="password2">Confirmar Contraseña:</label>
          <input type="password" id="password2" name="password2" required />
          <div class="error-message" id="error-password2"></div>
        </div>

        <!-- Fecha de Nacimiento -->
        <div class="form-group">
          <label for="fecha">Fecha de Nacimiento:</label>
          <input type="date" id="fecha" name="fecha" required />
          <div class="error-message" id="error-fecha"></div>
        </div>

        <!-- Teléfono -->
        <div class="form-group">
          <label for="telefono">Teléfono (opcional):</label>
          <input type="tel" id="telefono" name="telefono" />
        </div>

        <!-- Comuna -->
        <div class="form-group">
          <label for="comuna">Comuna:</label>
          <select name="comuna" id="comuna" required>
            <option value="">-- Seleccione la comuna --</option>
            <option value="Cerrillos">Cerrillos</option>
            <option value="Cerro Navia">Cerro Navia</option>
            <option value="Conchalí">Conchalí</option>
            <option value="El Bosque">El Bosque</option>
            <option value="Estación Central">Estación Central</option>
            <option value="Huechuraba">Huechuraba</option>
            <option value="Independencia">Independencia</option>
            <option value="La Cisterna">La Cisterna</option>
            <option value="La Florida">La Florida</option>
            <option value="La Granja">La Granja</option>
            <option value="La Pintana">La Pintana</option>
            <option value="La Reina">La Reina</option>
            <option value="Las Condes">Las Condes</option>
            <option value="Lo Barnechea">Lo Barnechea</option>
            <option value="Lo Espejo">Lo Espejo</option>
            <option value="Lo Prado">Lo Prado</option>
            <option value="Macul">Macul</option>
            <option value="Maipú">Maipú</option>
            <option value="Ñuñoa">Ñuñoa</option>
            <option value="Pedro Aguirre Cerda">Pedro Aguirre Cerda</option>
            <option value="Peñalolén">Peñalolén</option>
            <option value="Providencia">Providencia</option>
            <option value="Pudahuel">Pudahuel</option>
            <option value="Quilicura">Quilicura</option>
            <option value="Quinta Normal">Quinta Normal</option>
            <option value="Recoleta">Recoleta</option>
            <option value="Renca">Renca</option>
            <option value="San Joaquín">San Joaquín</option>
            <option value="San Miguel">San Miguel</option>
            <option value="San Ramón">San Ramón</option>
            <option value="Santiago">Santiago</option>
            <option value="Vitacura">Vitacura</option>
            <option value="Puente Alto">Puente Alto</option>
            <option value="Pirque">Pirque</option>
            <option value="San José de Maipo">San José de Maipo</option>
            <option value="Colina">Colina</option>
            <option value="Lampa">Lampa</option>
            <option value="Tiltil">Tiltil</option>
            <option value="San Bernardo">San Bernardo</option>
            <option value="Buin">Buin</option>
            <option value="Calera de Tango">Calera de Tango</option>
            <option value="Paine">Paine</option>
            <option value="Melipilla">Melipilla</option>
            <option value="Alhué">Alhué</option>
            <option value="Curacaví">Curacaví</option>
            <option value="María Pinto">María Pinto</option>
            <option value="San Pedro">San Pedro</option>
            <option value="Talagante">Talagante</option>
            <option value="El Monte">El Monte</option>
            <option value="Isla de Maipo">Isla de Maipo</option>
            <option value="Padre Hurtado">Padre Hurtado</option>
            <option value="Peñaflor">Peñaflor</option>
          </select>
          <div class="error-message" id="error-comuna"></div>
        </div>

        <!-- Botones -->
        <button type="submit" class="btn-primaria">Crear Cuenta</button>
        <button type="button" class="btn-secundaria" onclick="window.location.href='iniciarSesion.html'">
          ¿Ya tienes cuenta? Iniciar Sesión
        </button>
      </form>

      <!-- Mensaje de éxito -->
      <div class="success-message" id="success-message" style="display: none;">
        ¡Cuenta creada exitosamente! Redirigiendo al inicio de sesión...
      </div>
    </div>
  </main>

  <!-- ======================= FOOTER ======================= -->
  <footer class="footer" id="contacto">
    <nav aria-label="Redes">
      <a href="#">X</a> ·
      <a href="#" id="blog">Instagram</a> ·
      <a href="#">WhatsApp</a>
    </nav>

    <form class="newsletter" action="#" method="post">
      <label for="email">Suscríbete a nuestro newsletter</label>
      <input id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" />
      <button type="submit">Suscribirse</button>
    </form>
  </footer>

  <!-- JavaScript para validaciones -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('form-registro');
      const inputs = form.querySelectorAll('input[required], select[required]');
      
      // Función para validar RUN
      function validarRUN(run) {
        const runRegex = /^[0-9]{7,9}$/;
        return runRegex.test(run);
      }
      
      // Función para validar email
      function validarEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }
      
      // Función para validar nombre
      function validarNombre(nombre) {
        return nombre.trim().length >= 2;
      }
      
      // Función para validar contraseña
      function validarPassword(password) {
        return password.length >= 4 && password.length <= 10;
      }
      
      // Función para validar fecha
      function validarFecha(fecha) {
        const fechaNacimiento = new Date(fecha);
        const hoy = new Date();
        const edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
        return edad >= 18 && edad <= 100;
      }
      
      // Función para mostrar error
      function mostrarError(campoId, mensaje) {
        const campo = document.getElementById(campoId);
        const errorDiv = document.getElementById('error-' + campoId);
        
        campo.classList.remove('valid');
        campo.classList.add('invalid');
        errorDiv.textContent = mensaje;
        errorDiv.classList.add('show');
      }
      
      // Función para mostrar éxito
      function mostrarExito(campoId) {
        const campo = document.getElementById(campoId);
        const errorDiv = document.getElementById('error-' + campoId);
        
        campo.classList.remove('invalid');
        campo.classList.add('valid');
        errorDiv.classList.remove('show');
      }
      
      // Función para limpiar error
      function limpiarError(campoId) {
        const campo = document.getElementById(campoId);
        const errorDiv = document.getElementById('error-' + campoId);
        
        campo.classList.remove('invalid', 'valid');
        errorDiv.classList.remove('show');
      }
      
      // Validación en tiempo real
      inputs.forEach(input => {
        input.addEventListener('blur', function() {
          const campoId = this.id;
          const valor = this.value.trim();
          
          switch(campoId) {
            case 'run':
              if (valor && !validarRUN(valor)) {
                mostrarError(campoId, 'El RUN debe tener entre 7 y 9 dígitos');
              } else if (valor) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'nombre':
              if (valor && !validarNombre(valor)) {
                mostrarError(campoId, 'El nombre debe tener al menos 2 caracteres');
              } else if (valor) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'correo':
              if (valor && !validarEmail(valor)) {
                mostrarError(campoId, 'Ingresa un correo electrónico válido');
              } else if (valor) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'correo2':
              const correo1 = document.getElementById('correo').value;
              if (valor && valor !== correo1) {
                mostrarError(campoId, 'Los correos no coinciden');
              } else if (valor && valor === correo1) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'password':
              if (valor && !validarPassword(valor)) {
                mostrarError(campoId, 'La contraseña debe tener entre 4 y 10 caracteres');
              } else if (valor) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'password2':
              const password1 = document.getElementById('password').value;
              if (valor && valor !== password1) {
                mostrarError(campoId, 'Las contraseñas no coinciden');
              } else if (valor && valor === password1) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'fecha':
              if (valor && !validarFecha(valor)) {
                mostrarError(campoId, 'Debes ser mayor de 18 años');
              } else if (valor) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
              
            case 'comuna':
              if (valor) {
                mostrarExito(campoId);
              } else {
                limpiarError(campoId);
              }
              break;
          }
        });
        
        // Validación en tiempo real para confirmaciones
        if (input.id === 'correo') {
          input.addEventListener('input', function() {
            const correo2 = document.getElementById('correo2');
            if (correo2.value) {
              correo2.dispatchEvent(new Event('blur'));
            }
          });
        }
        
        if (input.id === 'password') {
          input.addEventListener('input', function() {
            const password2 = document.getElementById('password2');
            if (password2.value) {
              password2.dispatchEvent(new Event('blur'));
            }
          });
        }
      });
      
      // Validación del formulario completo
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        let esValido = true;
        
        // Validar todos los campos requeridos
        const run = document.getElementById('run').value.trim();
        const nombre = document.getElementById('nombre').value.trim();
        const correo = document.getElementById('correo').value.trim();
        const correo2 = document.getElementById('correo2').value.trim();
        const password = document.getElementById('password').value;
        const password2 = document.getElementById('password2').value;
        const fecha = document.getElementById('fecha').value;
        const comuna = document.getElementById('comuna').value;
        
        // Validaciones
        if (!validarRUN(run)) {
          mostrarError('run', 'El RUN es requerido y debe tener entre 7 y 9 dígitos');
          esValido = false;
        }
        
        if (!validarNombre(nombre)) {
          mostrarError('nombre', 'El nombre es requerido y debe tener al menos 2 caracteres');
          esValido = false;
        }
        
        if (!validarEmail(correo)) {
          mostrarError('correo', 'El correo electrónico es requerido y debe ser válido');
          esValido = false;
        }
        
        if (correo !== correo2) {
          mostrarError('correo2', 'Los correos no coinciden');
          esValido = false;
        }
        
        if (!validarPassword(password)) {
          mostrarError('password', 'La contraseña es requerida y debe tener entre 4 y 10 caracteres');
          esValido = false;
        }
        
        if (password !== password2) {
          mostrarError('password2', 'Las contraseñas no coinciden');
          esValido = false;
        }
        
        if (!validarFecha(fecha)) {
          mostrarError('fecha', 'La fecha de nacimiento es requerida y debes ser mayor de 18 años');
          esValido = false;
        }
        
        if (!comuna) {
          mostrarError('comuna', 'Debes seleccionar una comuna');
          esValido = false;
        }
        
        if (esValido) {
          // Mostrar mensaje de éxito
          const successMessage = document.getElementById('success-message');
          successMessage.style.display = 'block';
          
          // Simular envío del formulario
          setTimeout(() => {
            alert('¡Cuenta creada exitosamente!');
            window.location.href = 'iniciarSesion.html';
          }, 2000);
        } else {
          // Scroll al primer error
          const primerError = form.querySelector('.invalid');
          if (primerError) {
            primerError.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      });
    });
  </script>
</body>
</html>
